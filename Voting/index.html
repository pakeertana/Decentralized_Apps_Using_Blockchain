<!DOCTYPE html>
<html>
<head>
  <title>Voting DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f4f6f9;
      font-family: Arial, sans-serif;
    }

    .container {
      background: white;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      text-align: center;
      width: 400px;
    }

    input { margin: 5px; padding: 5px; width: 90%; }
    button { background-color: #007BFF; color: white; padding: 5px 10px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    h2 { color: darkblue; }
    ul { list-style: none; padding: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Voting DApp</h2>
    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress"></p>

    <h3>Manage Candidates</h3>
    <input type="text" id="candidateName" placeholder="Candidate Name">
    <button onclick="addCandidate()">Add Candidate</button>
    <button onclick="showCandidates()">Show Candidates</button>
    <ul id="candidateList"></ul>

    <h3>Vote</h3>
    <input type="number" id="candidateId" placeholder="Candidate ID">
    <button onclick="vote()">Vote</button>
    <button onclick="getCandidate()">Get Candidate Details</button>
    <p id="candidateDetails"></p>
  </div>

  <script>
    let web3;
    let contract;
    const contractAddress = "0x9054396712cf4a7678CFFB0cEE00449Eb787Ebf8";  // Replace with your deployed Voting contract
    const abi = [
	{
		"anonymous": false,
		"inputs": [
			{ "indexed": false, "internalType": "uint256", "name": "id", "type": "uint256" },
			{ "indexed": false, "internalType": "string", "name": "name", "type": "string" }
		],
		"name": "CandidateAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{ "indexed": false, "internalType": "address", "name": "voter", "type": "address" },
			{ "indexed": false, "internalType": "uint256", "name": "candidateId", "type": "uint256" }
		],
		"name": "Voted",
		"type": "event"
	},
	{
		"inputs": [{ "internalType": "string", "name": "_name", "type": "string" }],
		"name": "addCandidate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
		"name": "candidates",
		"outputs": [
			{ "internalType": "uint256", "name": "id", "type": "uint256" },
			{ "internalType": "string", "name": "name", "type": "string" },
			{ "internalType": "uint256", "name": "voteCount", "type": "uint256" }
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "candidatesCount",
		"outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [{ "internalType": "uint256", "name": "_candidateId", "type": "uint256" }],
		"name": "getCandidate",
		"outputs": [
			{ "internalType": "string", "name": "", "type": "string" },
			{ "internalType": "uint256", "name": "", "type": "uint256" }
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllCandidates",
		"outputs": [
			{
				"components": [
					{ "internalType": "uint256", "name": "id", "type": "uint256" },
					{ "internalType": "string", "name": "name", "type": "string" },
					{ "internalType": "uint256", "name": "voteCount", "type": "uint256" }
				],
				"internalType": "struct Voting.Candidate[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [{ "internalType": "uint256", "name": "_candidateId", "type": "uint256" }],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];

    async function connectWallet() {
      if (window.ethereum) {
        await ethereum.request({ method: 'eth_requestAccounts' });
        web3 = new Web3(window.ethereum);
        const accounts = await web3.eth.getAccounts();
        document.getElementById("walletAddress").innerText = "Connected: " + accounts[0];
        contract = new web3.eth.Contract(abi, contractAddress);
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function addCandidate() {
      const name = document.getElementById("candidateName").value;
      const accounts = await web3.eth.getAccounts();
      await contract.methods.addCandidate(name).send({ from: accounts[0] });
      alert("Candidate added: " + name);
    }

    async function showCandidates() {
      const candidates = await contract.methods.getAllCandidates().call();
      const list = document.getElementById("candidateList");
      list.innerHTML = "";
      candidates.forEach(c => {
        const li = document.createElement("li");
        li.innerText = `ID: ${c.id} | Name: ${c.name} | Votes: ${c.voteCount}`;
        list.appendChild(li);
      });
    }

    async function vote() {
      const id = parseInt(document.getElementById("candidateId").value);
      const accounts = await web3.eth.getAccounts();
      await contract.methods.vote(id).send({ from: accounts[0] });
      alert("Voted for candidate ID " + id);
    }

    async function getCandidate() {
      const id = parseInt(document.getElementById("candidateId").value);
      const candidate = await contract.methods.getCandidate(id).call();
      document.getElementById("candidateDetails").innerText =
        `Name: ${candidate[0]} | Votes: ${candidate[1]}`;
    }
  </script>
</body>
</html>
